import cv2

# Load the image
image = cv2.imread('00000002.jpg')

# Set the target file size in kilobytes (100 KB in this example)
target_file_size_kb = 100

# Try different compression quality levels until the file size is close to the target
for quality in range(1, 100):
    # Encode the image with the current quality setting
    _, encoded_image = cv2.imencode('.jpg', image, [cv2.IMWRITE_JPEG_QUALITY, quality])

    # Calculate the file size in kilobytes
    file_size_kb = len(encoded_image.tobytes()) / 1024

    # Check if the current quality level achieves the target file size
    if file_size_kb <= target_file_size_kb:
        # Save the compressed image
        cv2.imwrite('output_compressed.jpg', image, [cv2.IMWRITE_JPEG_QUALITY, quality])
        print(f"Image saved with quality level {quality} to achieve {file_size_kb:.2f} KB.")
        break
